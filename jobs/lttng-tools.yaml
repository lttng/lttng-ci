---
## SCM Anchors
- lttng-tools_default_git:
    name: 'lttng-tools_default_git'
    scm:
      - git: &lttng-tools_default_git
          url: https://github.com/{github_user}/lttng-tools.git
          browser: githubweb
          browser-url: https://github.com/{github_user}/lttng-tools
          branches:
            - '{version}'
          basedir: src/lttng-tools
          skip-tag: true

- lttng-modules_default_git:
    name: 'lttng-modules_default_git'
    scm:
      - git: &lttng-modules_default_git
          url: https://github.com/{github_user}/lttng-modules.git
          browser: githubweb
          browser-url: https://github.com/{github_user}/lttng-modules
          branches:
            - '{version}'
          basedir: src/lttng-modules
          skip-tag: true

- lttng-tools_gerrit_git:
    name: 'lttng-tools_gerrit_git'
    scm:
      - git: &lttng-tools_gerrit_git
          url: https://review.lttng.org/lttng-tools
          refspec: 'refs/changes/*:refs/changes/*'
          branches:
            - '$GERRIT_REFSPEC'
          basedir: src/lttng-tools
          skip-tag: true


## Defaults
- defaults:
    name: lttng-tools
    description: |
      The lttng-tools project provides a session daemon (lttng-sessiond)
      that acts as a tracing registry, the "lttng" command line for tracing
      control, a lttng-ctl library for tracing control and a lttng-relayd
      for network streaming.

      <p>Job is managed by Jenkins Job Builder.</p>

    project-type: freestyle

    wrappers:
      - ansicolor
      - timeout:
          timeout: 30
          fail: true
          type: no-activity
          write-description: "<h1 style=\"color:red\">This build failed due to timeout.</h1>"
      - timestamps
      - workspace-cleanup:
          clean-if:
            - failure: false

    scm:
      - git: *lttng-tools_default_git

    triggers:
      - pollscm:
          cron: "@hourly"

    properties:
      - inject:
          properties-content: |
            PROJECT_NAME=lttng-tools
      - github:
          url: https://github.com/{github_user}/lttng-tools
      - build-discarder:
          num-to-keep: 20
          artifact-num-to-keep: 2


## Axis Anchors
- lttng-tools_build_axes_defaults: &lttng-tools_build_axes_defaults
    name: 'lttng-tools_build_axes_defaults'
    project-type: matrix
    node: 'master' # Applies only to matrix flyweight task
    execution-strategy:
      combination-filter: '{filter}'
    axes:
      - axis:
         type: slave
         name: arch
         values: '{obj:arch}'
      - axis:
         type: user-defined
         name: conf
         values: '{obj:conf}'
      - axis:
         type: user-defined
         name: liburcu_version
         values: '{obj:urcuversion}'
      - axis:
         type: user-defined
         name: babeltrace_version
         values: '{obj:babelversion}'
      - axis:
         type: user-defined
         name: build
         values: '{obj:build}'
      - axis:
         type: user-defined
         name: test_type
         values: '{obj:testtype}'

- lttng-tools_build_axes_rootbuild: &lttng-tools_build_axes_rootbuild
    name: 'lttng-tools_build_axes_rootbuild'
    project-type: matrix
    node: 'master' # Applies only to matrix flyweight task
    execution-strategy:
      combination-filter: '{filter}'
    axes:
      - axis:
         type: slave
         name: node
         values:
           - 'amd64-rootnode'
      - axis:
         type: user-defined
         name: arch
         values: '{obj:arch}'
      - axis:
         type: user-defined
         name: conf
         values: '{obj:conf}'
      - axis:
         type: user-defined
         name: liburcu_version
         values: '{obj:urcuversion}'
      - axis:
         type: user-defined
         name: babeltrace_version
         values: '{obj:babelversion}'
      - axis:
         type: user-defined
         name: build
         values: '{obj:build}'
      - axis:
         type: user-defined
         name: test_type
         values: '{obj:testtype}'


## Builders Anchors
- lttng-tools_build_builders_defaults: &lttng-tools_build_builders_defaults
    name: 'lttng-tools_build_builders_defaults'
    builders:
      - conditional-step:
          condition-kind: regex-match
          label: '$conf'
          regex: (std|static)
          on-evaluation-failure: run
          steps:
            - copyartifact:
                project: liburcu_${{liburcu_version}}_{buildtype}/arch=${{arch}},conf=${{conf}},build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
            - copyartifact:
                project: babeltrace_${{babeltrace_version}}_{buildtype}/arch=${{arch}},conf=${{conf}},build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
            - copyartifact:
                project: lttng-ust_{ustversion}_{buildtype}/liburcu_version=${{liburcu_version}},arch=${{arch}},conf=${{conf}},build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
      - conditional-step:
          condition-kind: regex-match
          label: '$conf'
          regex: no-ust
          on-evaluation-failure: run
          steps:
            - copyartifact:
                project: liburcu_${{liburcu_version}}_{buildtype}/arch=${{arch}},conf=std,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
            - copyartifact:
                project: babeltrace_${{babeltrace_version}}_{buildtype}/arch=${{arch}},conf=std,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
      - conditional-step:
          condition-kind: regex-match
          label: '$conf'
          regex: agents
          on-evaluation-failure: run
          steps:
            - copyartifact:
                project: liburcu_${{liburcu_version}}_{buildtype}/arch=${{arch}},conf=std,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
            - copyartifact:
                project: babeltrace_${{babeltrace_version}}_{buildtype}/arch=${{arch}},conf=std,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
            - copyartifact:
                project: lttng-ust_{ustversion}_{buildtype}/liburcu_version=${{liburcu_version}},arch=${{arch}},conf=${{conf}},build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
      - conditional-step:
          condition-kind: regex-match
          label: '$conf'
          regex: (relayd-only)
          on-evaluation-failure: run
          steps:
            - copyartifact:
                project: liburcu_${{liburcu_version}}_{buildtype}/arch=${{arch}},conf=std,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
            - copyartifact:
                project: babeltrace_${{babeltrace_version}}_{buildtype}/arch=${{arch}},conf=std,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
      - conditional-step:
          condition-kind: regex-match
          label: '$conf'
          regex: debug-rcu
          on-evaluation-failure: run
          steps:
            - copyartifact:
                project: liburcu_${{liburcu_version}}_{buildtype}/arch=${{arch}},conf=debug-rcu,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
            - copyartifact:
                project: babeltrace_${{babeltrace_version}}_{buildtype}/arch=${{arch}},conf=std,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
            - copyartifact:
                project: lttng-ust_{ustversion}_{buildtype}/liburcu_version=${{liburcu_version}},arch=${{arch}},conf=debug-rcu,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
      - conditional-step:
          condition-kind: regex-match
          label: '$conf'
          regex: tls_fallback
          on-evaluation-failure: run
          steps:
            - copyartifact:
                project: liburcu_${{liburcu_version}}_{buildtype}/arch=${{arch}},conf=tls_fallback,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
            - copyartifact:
                project: babeltrace_${{babeltrace_version}}_{buildtype}/arch=${{arch}},conf=std,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
            - copyartifact:
                project: lttng-ust_{ustversion}_{buildtype}/liburcu_version=${{liburcu_version}},arch=${{arch}},conf=tls_fallback,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
      - shell:
         !include-raw-escape: scripts/lttng-tools/clean_processes_coredump.sh
      - shell:
         !include-raw-escape:
           - scripts/common/print.sh
           - scripts/lttng-tools/build.sh

- lttng-tools_build_builders_gerrit: &lttng-tools_build_builders_gerrit
    name: 'lttng-tools_build_builders_gerrit'
    builders:
      - shell:
         !include-raw-escape: scripts/lttng-tools/gerrit-depends-on.sh
      - inject:
          properties-file: gerrit_custom_dependencies.properties
      - copyartifact:
              project: babeltrace_${{babeltrace_version}}_{buildtype}/arch=${{arch}},conf=std,build=std
              which-build: last-successful
              stable: false
              filter: 'build/**'
              target: 'deps'
              do-not-fingerprint: true
      - conditional-step:
          condition-kind: and
          on-evaluation-failure: run
          condition-operands:
              - condition-kind: shell
                condition-command: 'test -z "$GERRIT_DEP_LTTNG_UST"'
              - condition-kind: regex-match
                label: '$conf'
                regex: (std|agents)
          steps:
            - copyartifact:
                project: lttng-ust_${{GERRIT_BRANCH}}_{buildtype}/liburcu_version=${{liburcu_version}},arch=${{arch}},conf=${{conf}},build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
      - conditional-step:
          condition-kind: shell
          on-evaluation-failure: run
          condition-command: 'test -z "$GERRIT_DEP_USERSPACE_RCU"'
          steps:
            - copyartifact:
                project: liburcu_${{liburcu_version}}_{buildtype}/arch=${{arch}},conf=std,build=std
                which-build: last-successful
                stable: false
                filter: 'build/**'
                target: 'deps'
                do-not-fingerprint: true
      - shell:
         !include-raw-escape: scripts/lttng-tools/clean_processes_coredump.sh
      - conditional-step:
          condition-kind: shell
          condition-command: 'test ! -z "$GERRIT_DEP_USERSPACE_RCU"'
          steps:
            - shell:
               !include-raw-escape:
                   - scripts/common/override-build-std.sh
                   - scripts/common/print.sh
                   - scripts/liburcu/build.sh
      - shell:
         !include-raw-escape: scripts/lttng-tools/gerrit-install-deps.sh
      - conditional-step:
          condition-kind: shell
          condition-command: 'test ! -z "$GERRIT_DEP_LTTNG_UST"'
          steps:
            - shell:
               !include-raw-escape:
                   - scripts/common/override-build-std.sh
                   - scripts/common/print.sh
                   - scripts/lttng-ust/build.sh
      - shell:
         !include-raw-escape: scripts/lttng-tools/gerrit-install-deps.sh
      - shell:
         !include-raw-escape:
           - scripts/common/print.sh
           - scripts/lttng-tools/build.sh

- lttng-tools_build_builders_win: &lttng-tools_build_builders_win
    name: 'lttng-tools_build_builders_win'
    builders:
      - copyartifact:
          project: liburcu_${{liburcu_version}}_winbuild/arch=${{arch}},conf=std,build=std
          which-build: last-successful
          stable: false
          filter: 'build/**'
          target: 'deps'
          do-not-fingerprint: true
      - conditional-step:
          condition-kind: strings-match
          on-evaluation-failure: run
          condition-string1: '${{arch}}'
          condition-string2: 'cygwin64'
          steps:
            - shell:
               !include-raw-escape:
                 - scripts/common/cygwin64-shebang
                 - scripts/common/cygpath-prefix
                 - scripts/common/print.sh
                 - scripts/lttng-tools/build.sh
      - conditional-step:
          condition-kind: strings-match
          on-evaluation-failure: run
          condition-string1: '${{arch}}'
          condition-string2: 'msys2-mingw32'
          steps:
            - inject:
               properties-content: 'MSYSTEM=MINGW32'
            - shell:
               !include-raw-escape:
                 - scripts/common/msys2-shebang
                 - scripts/common/cygpath-prefix
                 - scripts/common/print.sh
                 - scripts/lttng-tools/build.sh
      - conditional-step:
          condition-kind: strings-match
          on-evaluation-failure: run
          condition-string1: '${{arch}}'
          condition-string2: 'msys2-mingw64'
          steps:
            - inject:
               properties-content: 'MSYSTEM=MINGW64'
            - shell:
               !include-raw-escape:
                 - scripts/common/msys2-shebang
                 - scripts/common/cygpath-prefix
                 - scripts/common/print.sh
                 - scripts/lttng-tools/build.sh

- lttng-tools_build_publishers_dev: &lttng-tools_build_publishers_dev
    name: 'lttng-tools_build_publishers_dev'
    publishers:
      - postbuildscript:
          mark-unstable-if-failed: false
          builders:
            - role: SLAVE
              build-on:
                  - FAILURE
              build-steps:
                  - shell:
                      !include-raw-escape: scripts/lttng-tools/tap_failure.sh
      - postbuildscript:
          mark-unstable-if-failed: true
          builders:
            - role: SLAVE
              build-on:
                  - SUCCESS
                  - UNSTABLE
                  - NOT_BUILT
                  - ABORTED
                  - FAILURE
              build-steps:
                  - shell:
                      !include-raw-escape: scripts/lttng-tools/hang_processes.sh
      - tap:
          results: 'tap/**/*.*'
          fail-if-no-results: true
          failed-tests-mark-build-as-failure: true
          todo-is-failure: false
      - warnings:
          console-log-parsers:
            - 'GNU Make + GNU C Compiler (gcc)'
          total-thresholds:
            unstable:
              total-all: 0
              total-high: 0
              total-normal: 0
              total-low: 0
      - archive:
          artifacts: 'build/**,deps/**,tap/**'
          allow-empty: false
      - workspace-cleanup:
          clean-if:
            - failure: false
      - email-ext:
          recipients: '{obj:email_to}'
          always: false
          unstable: false
          first-failure: true
          first-unstable: true
          not-built: false
          aborted: false
          regression: false
          failure: false
          second-failure: false
          improvement: false
          still-failing: false
          success: false
          fixed: false
          fixed-unhealthy: true
          still-unstable: false
          pre-build: false
          matrix-trigger: only-parent
          send-to:
            - recipients

- lttng-tools_build_publishers_prod: &lttng-tools_build_publishers_prod
    name: 'lttng-tools_build_publishers_prod'
    publishers:
      - postbuildscript:
          mark-unstable-if-failed: false
          builders:
            - role: SLAVE
              build-on:
                  - FAILURE
              build-steps:
                  - shell:
                      !include-raw-escape: scripts/lttng-tools/tap_failure.sh
      - postbuildscript:
          mark-unstable-if-failed: true
          builders:
            - role: SLAVE
              build-on:
                  - SUCCESS
                  - UNSTABLE
                  - NOT_BUILT
                  - ABORTED
                  - FAILURE
              build-steps:
                  - shell:
                      !include-raw-escape: scripts/lttng-tools/hang_processes.sh
      - tap:
          results: 'tap/**/*.*'
          fail-if-no-results: true
          failed-tests-mark-build-as-failure: true
          todo-is-failure: false
      - warnings:
          console-log-parsers:
            - 'GNU Make + GNU C Compiler (gcc)'
          total-thresholds:
            unstable:
              total-all: 0
              total-high: 0
              total-normal: 0
              total-low: 0
      - workspace-cleanup:
          clean-if:
            - failure: false
      - archive:
          artifacts: 'build/**,deps/**,tap/**'
          allow-empty: false
      - email-ext:
          recipients: '{obj:email_to}'
          reply-to: ci-notification@lists.lttng.org
          always: false
          unstable: false
          first-failure: true
          first-unstable: true
          not-built: false
          aborted: false
          regression: false
          failure: false
          second-failure: false
          improvement: false
          still-failing: false
          success: false
          fixed: false
          fixed-unhealthy: true
          still-unstable: false
          pre-build: false
          matrix-trigger: only-parent
          send-to:
            - recipients

- lttng-tools_build_publishers_win: &lttng-tools_build_publishers_win
    name: 'lttng-tools_build_publishers_win'
    publishers:
      - tap:
          results: 'tap/**/*.*'
          fail-if-no-results: true
          failed-tests-mark-build-as-failure: true
          todo-is-failure: false
      - warnings:
          console-log-parsers:
            - 'GNU Make + GNU C Compiler (gcc)'
          total-thresholds:
            unstable:
              total-all: 0
              total-high: 0
              total-normal: 0
              total-low: 0
      - workspace-cleanup:
          clean-if:
            - failure: false
      - archive:
          artifacts: 'build/**,deps/**,tap/**'
          allow-empty: false
      - email-ext:
          recipients: '{obj:email_to}'
          reply-to: ci-notification@lists.lttng.org
          always: false
          unstable: false
          first-failure: true
          first-unstable: true
          not-built: false
          aborted: false
          regression: false
          failure: false
          second-failure: false
          improvement: false
          still-failing: false
          success: false
          fixed: false
          fixed-unhealthy: true
          still-unstable: false
          pre-build: false
          matrix-trigger: only-parent
          send-to:
            - recipients

## Templates
- job-template:
    name: lttng-tools_{version}_{buildtype}
    defaults: lttng-tools

    <<: *lttng-tools_build_axes_defaults
    <<: *lttng-tools_build_builders_defaults
    <<: *lttng-tools_build_publishers_prod

    triggers:
      - pollscm:
          cron: "@hourly"
      - reverse:
            jobs: 'lttng-ust_{version}_{buildtype}'
            result: 'success'

- job-template:
    name: lttng-tools_{version}_long_regression
    defaults: lttng-tools
    wrappers:
      - ansicolor
      - timeout:
          timeout: 45
          fail: true
          type: no-activity
          write-description: "<h1 style=\"color:red\">This build failed due to timeout.</h1>"
      - timestamps
      - workspace-cleanup:
          clean-if:
            - failure: false

    <<: *lttng-tools_build_axes_defaults
    <<: *lttng-tools_build_builders_defaults
    <<: *lttng-tools_build_publishers_prod

    triggers:
      - pollscm:
          cron: "@hourly"
      - reverse:
            jobs: 'lttng-ust_{version}_{buildtype}'
            result: 'success'

- job-template:
    name: lttng-tools_{version}_rootbuild
    defaults: lttng-tools

    scm:
      - git: *lttng-tools_default_git
      - git: *lttng-modules_default_git

    wrappers:
      - ansicolor
      - timeout:
          timeout: 10
          fail: true
          type: no-activity
          write-description: "<h1 style=\"color:red\">This build failed due to timeout.</h1>"
      - timestamps

    <<: *lttng-tools_build_axes_rootbuild
    <<: *lttng-tools_build_builders_defaults
    <<: *lttng-tools_build_publishers_prod

    triggers:
      - pollscm:
          cron: "@hourly"
      - reverse:
            jobs: 'lttng-ust_{version}_build'
            result: 'success'

- job-template:
    name: lttng-tools_{version}_winbuild
    defaults: lttng-tools

    <<: *lttng-tools_build_axes_defaults
    <<: *lttng-tools_build_builders_win
    <<: *lttng-tools_build_publishers_win

- job-template:
    name: dev_{user}_lttng-tools_{version}_{buildtype}
    defaults: lttng-tools

    <<: *lttng-tools_build_axes_defaults
    <<: *lttng-tools_build_builders_defaults
    <<: *lttng-tools_build_publishers_dev

- job-template:
    name: dev_gerrit_lttng-tools_{buildtype}
    defaults: lttng-tools
    concurrent: true

    scm:
      - git: *lttng-tools_gerrit_git

    triggers:
      - gerrit:
          trigger-on:
            - comment-added-event:
                approval-category: 'CI-Build'
                approval-value: 1
          projects:
            - project-compare-type: 'PLAIN'
              project-pattern: 'lttng-tools'
              branches:
                - branch-compare-type: 'ANT'
                  branch-pattern: '**'

    properties:
      - inject:
          properties-content: |
            PROJECT_NAME=lttng-tools
      - build-discarder:
          days-to-keep: 1
      - throttle:
          option: 'category'
          categories:
            - 'gerrit-{buildtype}'

    <<: *lttng-tools_build_axes_defaults
    <<: *lttng-tools_build_builders_gerrit

    publishers:
      - postbuildscript:
          mark-unstable-if-failed: false
          builders:
            - role: SLAVE
              build-on:
                  - FAILURE
              build-steps:
                  - shell:
                      !include-raw-escape: scripts/lttng-tools/tap_failure.sh
      - postbuildscript:
          mark-unstable-if-failed: true
          builders:
            - role: SLAVE
              build-on:
                  - SUCCESS
                  - UNSTABLE
                  - NOT_BUILT
                  - ABORTED
                  - FAILURE
              build-steps:
                  - shell:
                      !include-raw-escape: scripts/lttng-tools/hang_processes.sh
      - tap:
          results: 'tap/**/*.*'
          fail-if-no-results: true
          failed-tests-mark-build-as-failure: true
          todo-is-failure: false
      - warnings:
          console-log-parsers:
            - 'GNU Make + GNU C Compiler (gcc)'
          total-thresholds:
            unstable:
              total-all: 0
              total-high: 0
              total-normal: 0
              total-low: 0
      - archive:
          artifacts: 'build/**,deps/**,tap/**'
          allow-empty: false
      - workspace-cleanup:
          clean-if:
            - failure: false

- job-template:
    name: dev_gerrit_lttng-tools_rootbuild
    defaults: lttng-tools
    concurrent: true

    scm:
      - git: *lttng-tools_gerrit_git
      - git:
          <<: *lttng-modules_default_git
          branches:
            - '$GERRIT_BRANCH'

    triggers:
      - gerrit:
          trigger-on:
            - comment-added-event:
                approval-category: 'CI-Build'
                approval-value: 1
          projects:
            - project-compare-type: 'PLAIN'
              project-pattern: 'lttng-tools'
              branches:
                - branch-compare-type: 'ANT'
                  branch-pattern: '**'

    properties:
      - inject:
          properties-content: |
            PROJECT_NAME=lttng-tools
      - build-discarder:
          days-to-keep: 1
      - throttle:
          option: 'category'
          categories:
            - 'gerrit-{buildtype}'

    <<: *lttng-tools_build_axes_rootbuild
    <<: *lttng-tools_build_builders_gerrit

    publishers:
      - tap:
          results: 'tap/**/*.*'
          fail-if-no-results: true
          failed-tests-mark-build-as-failure: true
          todo-is-failure: false
      - warnings:
          console-log-parsers:
            - 'GNU Make + GNU C Compiler (gcc)'
          total-thresholds:
            unstable:
              total-all: 0
              total-high: 0
              total-normal: 0
              total-low: 0
      - archive:
          artifacts: 'build/**,deps/**,tap/**'
          allow-empty: false
      - workspace-cleanup:
          clean-if:
            - failure: false

- job-template:
    name: lttng-tools_{version}_release
    defaults: lttng-tools
    node: 'amd64'

    triggers:
      - pollscm:
          cron: "@daily"

    scm:
      - git:
          url: https://github.com/{github_user}/lttng-tools.git
          browser: githubweb
          browser-url: https://github.com/{github_user}/lttng-tools
          refspec: '+refs/tags/*:refs/remotes/origin/tags/*'
          branches:
            - '*/tags/{version}.*'
          basedir: src/lttng-tools

    builders:
      - copyartifact:
          project: liburcu_{urcuversion}_build/arch=amd64,conf=std,build=std
          which-build: last-successful
          stable: false
          filter: 'build/**'
          target: 'deps'
          do-not-fingerprint: true
      - copyartifact:
          project: babeltrace_{babelversion}_build/arch=amd64,conf=std,build=std
          which-build: last-successful
          stable: false
          filter: 'build/**'
          target: 'deps'
          do-not-fingerprint: true
      - copyartifact:
          project: lttng-ust_{ustversion}_build/liburcu_version={urcuversion},arch=amd64,conf=agents,build=std
          which-build: last-successful
          stable: false
          filter: 'build/**'
          target: 'deps'
          do-not-fingerprint: true
      - shell:
          !include-raw-escape: scripts/lttng-tools/clean_processes_coredump.sh
      - shell:
          !include-raw-escape: scripts/lttng-tools/release.sh

    publishers:
      - postbuildscript:
          mark-unstable-if-failed: false
          builders:
            - role: SLAVE
              build-on:
                  - ABORTED
              build-steps:
                  - shell:
                      !include-raw-escape: scripts/lttng-tools/tap_failure.sh
      - postbuildscript:
          mark-unstable-if-failed: true
          builders:
            - role: SLAVE
              build-on:
                  - SUCCESS
                  - UNSTABLE
                  - NOT_BUILT
                  - ABORTED
                  - FAILURE
              build-steps:
                  - shell:
                      !include-raw-escape: scripts/lttng-tools/hang_processes.sh
      - tap:
          results: 'tap/**/*.*'
          fail-if-no-results: true
          failed-tests-mark-build-as-failure: true
          todo-is-failure: false
      - warnings:
          console-log-parsers:
            - 'GNU Make + GNU C Compiler (gcc)'
          total-thresholds:
            unstable:
              total-all: 0
              total-high: 0
              total-normal: 0
              total-low: 0
      - workspace-cleanup:
          clean-if:
            - failure: false
      - archive:
          artifacts: 'out/**'
          allow-empty: false

- job-template:
    name: lttng-tools_{version}_cppcheck
    defaults: lttng-tools

    triggers:
      - pollscm:
          cron: "@daily"

    builders:
      - shell: |
          rm -f cppcheck-result.xml
          cppcheck --enable=all --xml --xml-version=2 $WORKSPACE 2> cppcheck-result.xml

    publishers:
      - archive:
          artifacts: 'cppcheck-result.xml'
          allow-empty: false
      - cppcheck:
          pattern: 'cppcheck-result.xml'
      - email-ext:
          recipients: 'ci-notification@lists.lttng.org'
          reply-to: ci-notification@lists.lttng.org
          always: false
          unstable: false
          first-failure: true
          first-unstable: true
          not-built: false
          aborted: false
          regression: false
          failure: false
          second-failure: false
          improvement: false
          still-failing: false
          success: false
          fixed: false
          fixed-unhealthy: true
          still-unstable: false
          pre-build: false
          matrix-trigger: only-parent
          send-to:
            - recipients

- job-template:
    name: lttng-tools_{version}_scan-build
    defaults: lttng-tools
    node: 'amd64'

    triggers:
      - pollscm:
          cron: "@daily"

    builders:
      - copyartifact:
          project: liburcu_{urcuversion}_build/arch=amd64,conf=std,build=std
          which-build: last-successful
          stable: false
          filter: 'build/**'
          target: 'deps'
          do-not-fingerprint: true
      - copyartifact:
          project: lttng-ust_{ustversion}_build/liburcu_version={urcuversion},arch=amd64,conf=std,build=std
          which-build: last-successful
          stable: false
          filter: 'build/**'
          target: 'deps'
          do-not-fingerprint: true
      - shell:
          !include-raw-escape: scripts/common/scan-build.sh

    publishers:
      - html-publisher:
          name: 'HTML Report'
          dir: 'scan-build-archive/'
          files: 'index.html'

- job-template:
    name: lttng-tools_{version}_coverity
    defaults: lttng-tools
    node: 'amd64'

    triggers:
      - pollscm:
          cron: "@daily"

    wrappers:
      - workspace-cleanup
      - timestamps
      - ansicolor:
          colormap: xterm
      - credentials-binding:
          - username-password-separated:
              credential-id: lttng-tools_coverity_token
              username: COVERITY_SCAN_PROJECT_NAME
              password: COVERITY_SCAN_TOKEN

    builders:
      - copyartifact:
          project: liburcu_{urcuversion}_build/arch=amd64,conf=std,build=std
          which-build: last-successful
          stable: false
          filter: 'build/**'
          target: 'deps'
          do-not-fingerprint: true
      - copyartifact:
          project: lttng-ust_{ustversion}_build/liburcu_version={urcuversion},arch=amd64,conf=std,build=std
          which-build: last-successful
          stable: false
          filter: 'build/**'
          target: 'deps'
          do-not-fingerprint: true
      - shell:
          !include-raw-escape: scripts/common/coverity.sh

    publishers:
      - archive:
          artifacts: 'analysis-results.tgz,cov-int/**'
          allow-empty: false
      - workspace-cleanup


## Views
- view-template:
    name: 'LTTng-tools'
    view-type: list
    regex: 'lttng-tools[-_].*'


## Projects
- project:
    name: lttng-tools
    github_user: lttng
    email_to: 'ci-notification@lists.lttng.org, cc:jgalar@efficios.com'
    version:
      - stable-2.10
      - stable-2.11
      - stable-2.12
      - stable-2.13
      - master
    jobs:
      # Master #
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: build
          version: master
          ustversion: master
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist]
          conf: !!python/tuple [std, no-ust, agents, debug-rcu, tls_fallback]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-2.0, master]
          testtype: !!python/tuple [base]
          filter: '(build=="std") || ((babeltrace_version=="master" && (conf=="std" || conf=="agents" || conf=="no-ust")))'
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: portbuild
          version: master
          ustversion: master
          arch: !!python/tuple [armhf, arm64, powerpc, ppc64el, i386]
          build: !!python/tuple [std]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: slesbuild
          version: master
          ustversion: master
          arch: !!python/tuple [sles12sp5]
          build: !!python/tuple [std]
          conf: !!python/tuple [agents]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: elbuild
          version: master
          ustversion: master
          arch: !!python/tuple [el8]
          build: !!python/tuple [std]
          conf: !!python/tuple [std]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: macosbuild
          version: master
          ustversion: master
          arch: !!python/tuple [macos-amd64, macos-arm64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_winbuild':
          version: master
          ustversion: master
          arch: !!python/tuple [cygwin64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_long_regression':
          buildtype: build
          version: master
          ustversion: master
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std]
          conf: !!python/tuple [std]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [full]
          filter: ''
      - 'lttng-tools_{version}_rootbuild':
          buildtype: build
          version: master
          ustversion: master
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std]
          conf: !!python/tuple [agents]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''

      # stable-2.13
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: build
          version: stable-2.13
          ustversion: stable-2.13
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist]
          conf: !!python/tuple [std, no-ust, agents, debug-rcu, tls_fallback]
          urcuversion: !!python/tuple [stable-0.13]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: '(build=="std") || ((babeltrace_version=="stable-2.0" && (conf=="std" || conf=="agents" || conf=="no-ust")))'
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: portbuild
          version: stable-2.13
          ustversion: stable-2.13
          arch: !!python/tuple [armhf, arm64, powerpc, ppc64el, i386]
          build: !!python/tuple [std]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.13]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: slesbuild
          version: stable-2.13
          ustversion: stable-2.13
          arch: !!python/tuple [sles12sp5]
          build: !!python/tuple [std]
          conf: !!python/tuple [agents]
          urcuversion: !!python/tuple [stable-0.13]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: elbuild
          version: stable-2.13
          ustversion: stable-2.13
          arch: !!python/tuple [el8]
          build: !!python/tuple [std]
          conf: !!python/tuple [std]
          urcuversion: !!python/tuple [stable-0.13]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: macosbuild
          version: stable-2.13
          ustversion: stable-2.13
          arch: !!python/tuple [macos-amd64, macos-arm64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [stable-0.13]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_winbuild':
          version: stable-2.13
          ustversion: stable-2.13
          arch: !!python/tuple [cygwin64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [stable-0.13]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_long_regression':
          buildtype: build
          version: stable-2.13
          ustversion: stable-2.13
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std]
          conf: !!python/tuple [std]
          urcuversion: !!python/tuple [stable-0.13]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [full]
          filter: ''
      - 'lttng-tools_{version}_rootbuild':
          buildtype: build
          version: stable-2.13
          ustversion: stable-2.13
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std]
          conf: !!python/tuple [agents]
          urcuversion: !!python/tuple [stable-0.13]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_release':
          version: v2.13
          ustversion: stable-2.13
          urcuversion: stable-0.13
          babelversion: stable-2.0

      # stable-2.12
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: build
          version: stable-2.12
          ustversion: stable-2.12
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist]
          conf: !!python/tuple [std, no-ust, agents, debug-rcu, tls_fallback]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: '(build=="std") || ((babeltrace_version=="stable-2.0" && (conf=="std" || conf=="agents" || conf=="no-ust")))'
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: portbuild
          version: stable-2.12
          ustversion: stable-2.12
          arch: !!python/tuple [armhf, arm64, powerpc, ppc64el, i386]
          build: !!python/tuple [std]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: slesbuild
          version: stable-2.12
          ustversion: stable-2.12
          arch: !!python/tuple [sles12sp5]
          build: !!python/tuple [std]
          conf: !!python/tuple [agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: elbuild
          version: stable-2.12
          ustversion: stable-2.12
          arch: !!python/tuple [el8]
          build: !!python/tuple [std]
          conf: !!python/tuple [std]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: macosbuild
          version: stable-2.12
          ustversion: stable-2.12
          arch: !!python/tuple [macos-amd64, macos-arm64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_winbuild':
          version: stable-2.12
          ustversion: stable-2.12
          arch: !!python/tuple [cygwin64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_long_regression':
          buildtype: build
          version: stable-2.12
          ustversion: stable-2.12
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std]
          conf: !!python/tuple [std]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [full]
          filter: ''
      - 'lttng-tools_{version}_rootbuild':
          buildtype: build
          version: stable-2.12
          ustversion: stable-2.12
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std]
          conf: !!python/tuple [agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_release':
          version: v2.12
          ustversion: stable-2.12
          urcuversion: stable-0.12
          babelversion: stable-2.0

      # stable-2.11
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: build
          version: stable-2.11
          ustversion: stable-2.11
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist]
          conf: !!python/tuple [std, no-ust, agents, debug-rcu, tls_fallback]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: '(build=="std") || ((babeltrace_version=="stable-1.5" && (conf=="std" || conf=="agents" || conf=="no-ust")))'
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: portbuild
          version: stable-2.11
          ustversion: stable-2.11
          arch: !!python/tuple [armhf, arm64, powerpc, ppc64el, i386]
          build: !!python/tuple [std]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: slesbuild
          version: stable-2.11
          ustversion: stable-2.11
          arch: !!python/tuple [sles12sp5]
          build: !!python/tuple [std]
          conf: !!python/tuple [agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: elbuild
          version: stable-2.11
          ustversion: stable-2.11
          arch: !!python/tuple [el8]
          build: !!python/tuple [std]
          conf: !!python/tuple [std]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: macosbuild
          version: stable-2.11
          ustversion: stable-2.11
          arch: !!python/tuple [macos-amd64, macos-arm64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_winbuild':
          version: stable-2.11
          ustversion: stable-2.11
          arch: !!python/tuple [cygwin64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_long_regression':
          buildtype: build
          version: stable-2.11
          ustversion: stable-2.11
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std]
          conf: !!python/tuple [std]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [full]
          filter: ''
      - 'lttng-tools_{version}_rootbuild':
          buildtype: build
          version: stable-2.11
          ustversion: stable-2.11
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std]
          conf: !!python/tuple [agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_release':
          version: v2.11
          ustversion: stable-2.11
          urcuversion: stable-0.12
          babelversion: stable-1.5

      # stable-2.10
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: build
          version: stable-2.10
          ustversion: stable-2.10
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist]
          conf: !!python/tuple [std, no-ust, agents, debug-rcu, tls_fallback]
          urcuversion: !!python/tuple [stable-0.9]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: '(build=="std") || ((babeltrace_version=="stable-1.5" && (conf=="std" || conf=="agents" || conf=="no-ust")))'
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: portbuild
          version: stable-2.10
          ustversion: stable-2.10
          arch: !!python/tuple [armhf, arm64, powerpc, ppc64el, i386]
          build: !!python/tuple [std]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.9]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: slesbuild
          version: stable-2.10
          ustversion: stable-2.10
          arch: !!python/tuple [sles12sp5]
          build: !!python/tuple [std]
          conf: !!python/tuple [agents]
          urcuversion: !!python/tuple [stable-0.9]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: elbuild
          version: stable-2.10
          ustversion: stable-2.10
          arch: !!python/tuple [el8]
          build: !!python/tuple [std]
          conf: !!python/tuple [std]
          urcuversion: !!python/tuple [stable-0.9]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_{buildtype}':
          buildtype: macosbuild
          version: stable-2.10
          ustversion: stable-2.10
          arch: !!python/tuple [macos-amd64, macos-arm64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [stable-0.9]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_winbuild':
          version: stable-2.10
          ustversion: stable-2.10
          arch: !!python/tuple [cygwin64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [stable-0.9]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'lttng-tools_{version}_long_regression':
          buildtype: build
          version: stable-2.10
          ustversion: stable-2.10
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std]
          conf: !!python/tuple [std]
          urcuversion: !!python/tuple [stable-0.9]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [full]
          filter: ''
      - 'lttng-tools_{version}_release':
          version: v2.10
          ustversion: stable-2.10
          urcuversion: stable-0.9
          babelversion: stable-1.5

      - 'lttng-tools_{version}_cppcheck'
      - 'lttng-tools_{version}_scan-build':
          version: master
          urcuversion: master
          ustversion: master
      - 'lttng-tools_{version}_scan-build':
          version: stable-2.11
          urcuversion: stable-0.12
          ustversion: stable-2.11
      - 'lttng-tools_{version}_scan-build':
          version: stable-2.10
          urcuversion: stable-0.9
          ustversion: stable-2.10
      - 'lttng-tools_{version}_coverity':
          version: master
          urcuversion: master
          ustversion: master


- project:
    name: dev_jgalar_lttng-tools
    user: jgalar
    github_user: jgalar
    email_to: 'jgalar@efficios.com'
    jobs:
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: build
          version: master-staging
          ustversion: master
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-2.0, master]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: build
          version: stable-2.13-staging
          ustversion: stable-2.13
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0, master]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: build
          version: stable-2.12-staging
          ustversion: stable-2.12
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0, master]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: build
          version: stable-2.11-staging
          ustversion: stable-2.11
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-1.5, master]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: build
          version: stable-2.10-staging
          ustversion: stable-2.10
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.9]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: portbuild
          version: master-staging
          ustversion: master
          arch: !!python/tuple [armhf, arm64, powerpc, ppc64el, i386]
          build: !!python/tuple [std]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-1.5, master]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: portbuild
          version: stable-2.13-staging
          ustversion: stable-2.13
          arch: !!python/tuple [armhf, arm64, powerpc, ppc64el, i386]
          build: !!python/tuple [std]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: portbuild
          version: stable-2.12-staging
          ustversion: stable-2.12
          arch: !!python/tuple [armhf, arm64, powerpc, ppc64el, i386]
          build: !!python/tuple [std]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: portbuild
          version: stable-2.11-staging
          ustversion: stable-2.11
          arch: !!python/tuple [armhf, arm64, powerpc, ppc64el, i386]
          build: !!python/tuple [std]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.12]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: portbuild
          version: stable-2.10-staging
          ustversion: stable-2.10
          arch: !!python/tuple [armhf, arm64, powerpc, ppc64el, i386]
          build: !!python/tuple [std]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [stable-0.9]
          babelversion: !!python/tuple [stable-1.5]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_{user}_lttng-tools_{version}_{buildtype}':
          buildtype: macosbuild
          version: master-staging
          ustversion: master
          arch: !!python/tuple [macos-amd64, macos-arm64]
          build: !!python/tuple [std]
          conf: !!python/tuple [relayd-only]
          urcuversion: !!python/tuple [master]
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''

- project:
    name: gerrit-lttng-tools
    github_user: lttng
    jobs:
      - 'dev_gerrit_lttng-tools_{buildtype}':
          buildtype: build
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std, oot, dist, oot-dist]
          conf: !!python/tuple [std, no-ust, agents]
          urcuversion: !!python/tuple [master] # Switch to stable-0.14 when released (for C++ support)
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''
      - 'dev_gerrit_lttng-tools_rootbuild':
          buildtype: build
          arch: !!python/tuple [amd64]
          build: !!python/tuple [std]
          conf: !!python/tuple [agents]
          urcuversion: !!python/tuple [master] # Switch to stable-0.14 when released (for C++ support)
          babelversion: !!python/tuple [stable-2.0]
          testtype: !!python/tuple [base]
          filter: ''

- project:
    name: lttng-tools-views
    views:
      - LTTng-tools
